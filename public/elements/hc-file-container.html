<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="hc-file-displayer.html"/>
<dom-module id="hc-file-container">

<style>
	#container{
		background-color: #4d4d4d;
	}
	.wrapper{
		position:absolute;
		transition: all 2s;
	}
	
</style>

	<template>
	<div id="container">
	<!-- <hc-file-displayer height width></hc-file-displayer>
	<hc-file-displayer height width></hc-file-displayer> -->
	</div>
	<input type="button" value="rotate-stuff" id="presentation"/>

		
	</template>

	<script src="../js/Sprite3D.js" type="text/javascript"></script>
	<script>
	(function () {
    'use strict';
    Polymer({
      is: 'hc-file-container',
      properties: {
        height:{
          type: Number,
          value:500,
          notify:true
        },
        width:{
          type: Number,
          value:500,
          notify:true
        },
        id:{
          type:String,
          notify:true
        },
        data:{
        	type:Object,
        	value:{
        		name:"placeholder",
        		relations:[
        		{name:"pl1", code:"more code"},
        		{name:"pl2", code:"even more code"} 
        		],
        		source:"some code"
        	}
        },
        files:{
        	type: Object,
        },
        stage:{},

      },
      

      ready:function(){
      	this.width=window.innerWidth-30
      	this.height=window.innerHeight-30
        this.$.container.style.width= this.width+"px" //this.width+"px"
        this.$.container.style.height= this.height+"px"//this.height+"px"
        this.stage = Sprite3D.stage(this.$.container);
        // let mainFile = document.createElement("hc-file-displayer");
        // mainFile.setAttribute("width",400);
        // mainFile.setAttribute("height",300);
        // let x=this.stage.appendChild(Sprite3D.create(mainFile))
        // x.position(500,500).update()
        
        this.setUp();


      },
      setUp:function(){

       let files=[]
       files.push(this.createFileDisplayer(40,90, 50,50,null, true)) //main
       files.push(this.createFileDisplayer(20,60, 15,50))
       files.push(this.createFileDisplayer(20,60, 85,50))
       this.files={list:files, mainIndex:0} // index of main
       let x = this;
       // let elements= Polymer.dom(this.root).querySelectorAll(".wrapper"))
       let app = this;
       for(let i =0; i< files.length; i++){
        files[i].index=i;

        files[i].sprite.onclick=function(e){
          app.swapWithMain(files[i].index)
        }
       }
       this.$.presentation.onclick=function(){
       	// window.setInterval(function(){
       		files.forEach(function(item){
       			item.sprite.rotate(0,180,0).update()
       		})
       	// 	files[1].move(0,4,0)
       	// }, 50)
       }
      },
      //horrible code but only temporary
      swapWithMain:function(index){
      	if(index == this.files.mainIndex){
      		return;
      	}
      	let spriteOne = this.files.list[index]
      	let mainSprite= this.files.list[this.files.mainIndex]
        let posOne = spriteOne.pos
        let posMain = mainSprite.pos
      	spriteOne.sprite.firstChild.setAttribute("width",posMain.width)
        spriteOne.sprite.firstChild.setAttribute("height",posMain.height)

        mainSprite.sprite.firstChild.setAttribute("width",posOne.width)
        mainSprite.sprite.firstChild.setAttribute("height",posOne.height)

      	spriteOne.sprite.position(posMain.x, posMain.y).update()
      	mainSprite.sprite.position(posOne.x, posOne.y).update()
        for(let key in posOne){
          console.log(key)
          let temp = posOne[key]
          posOne[key] =posMain[key]
          posMain[key] = temp
        }
        this.files.mainIndex = index
        
      	// spriteOne.x
      	// spriteOne.y
      },
      // setWidthHeight:function(width,height){

      // },
      // everythin in percentages according of this.height and this.width
      createFileDisplayer(width, height, x, y,id, active){
      	let percX=this.width/100
      	let percY=this.height/100
      	// let element = document.createElement("hc-file-displayer");
      	let element = document.createElement("div")
      	element.style.width=percX*width+"px";
      	element.style.height=percY*height+"px";
      	console.log(percX*width)
      	element.style.position="absolute"
      	element.className="wrapper"
      	element.style.transition="all 2s"

      	let innerElement = document.createElement("hc-file-displayer");
      	innerElement.setAttribute("width",percX*width);
        innerElement.setAttribute("height",percY*height);
        if(active){
        	innerElement.setAttribute("is-editable",true);
        }
        element.appendChild(innerElement)
        let sprite = this.stage.appendChild(Sprite3D.create(element));
        sprite.position(percX*x-innerElement.width/2, percY*y-innerElement.height/2).update();

       
        return{sprite:sprite,
          pos:{
            x:percX*x-innerElement.width/2,
            y:percY*y-innerElement.height/2,
            width:percX*width,
            height:percY*height
          }};
      }

    });
})();

	</script>

</dom-module>